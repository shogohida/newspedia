(window.webpackJsonp=window.webpackJsonp||[]).push([["o-overlay"],{"20ee13ff":function(t,e,o){"use strict";o.r(e);var i=o("1063c397"),s=o("922a4198"),r=o("ddc24f87"),n={unCapitalise:function(t){return t.charAt(0).toLowerCase()+t.substr(1)},capitalise:function(t){return t.charAt(0).toUpperCase()+t.substr(1)},copyContentFromElement:function(t,e){e("SCRIPT"===t.nodeName?t.innerHTML:t.outerHTML)},copyContentFromUrl:function(t,e){var o=new XMLHttpRequest;o.open("GET",t,!0),o.onload=function(){4===o.readyState&&(200===o.status?e(o.responseText):e("Content failed to load correctly"))},o.onerror=function(e){throw new Error('"o-overlay error": Fetching content from '+t+" failed with errror "+e)},o.send(null)},optionsFromKey:function(t,e,o){var i=t.indexOf("-");if(-1===i)try{o[t]=JSON.parse(e.replace(/\'/g,'"'))}catch(i){o[t]=e}else{var s=t.substr(0,i);o[s]||(o[s]={}),o[s]=this.optionsFromKey(t.substr(i+1),e,o[s])}return o},getOffsetRect:function(t){var e=t.getBoundingClientRect(),o=document.body,i=document.documentElement,s=window.pageYOffset||i.scrollTop||o.scrollTop,r=window.pageXOffset||i.scrollLeft||o.scrollLeft,n=i.clientTop||o.clientTop||0,a=i.clientLeft||o.clientLeft||0;return{width:e.width||e.right-e.left,height:e.height||e.bottom-e.top,top:e.top+s-n,left:e.left+r-a}}};function a(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return l(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return l(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,i=new Array(e);o<e;o++)i[o]=t[o];return i}function h(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var c={},d=function(t){var e={};return t instanceof HTMLElement&&(Array.prototype.forEach.call(t.attributes,(function(t){if(0===t.name.indexOf("data-o-overlay")){var o=t.name.replace("data-o-overlay-","");e=n.optionsFromKey(o,t.value,e)}})),e.trigger=t),e},p=function(t,e){e.stopPropagation();var o=c[t];o&&(!0===o.visible?o.close():o.open())},u=function(t){return Boolean(t.offsetHeight)},f=function(t){var e=[].slice.call(this.wrapper.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')).filter((function(t){var e=u(t),o=t.labels&&[].slice.call(t.labels).some((function(t){return u(t)})),i="radio"===t.type&&!0!==t.checked;return!t.disabled&&!i&&(e||o)}));if(e.length&&9===t.keyCode){var o=e[e.length-1];t.target===o?(e[0].focus(),t.preventDefault()):t.shiftKey&&t.target===e[0]&&(o.focus(),t.preventDefault())}},y=function(){function t(e,o){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),c[e])throw new Error('o-overlay with id "'.concat(e,'" already exists. Creating an overlay twice with the same id may result in unexpected behaviour.'));s.default.listenTo("resize"),this.visible=!1,this.id=e;try{this.opts=function(t){if(!t.trigger||t.trigger instanceof HTMLElement||(t.trigger=document.querySelector(t.trigger)),t.heading&&(!t.heading.title||!t.heading.title.trim()))throw new Error('"o-overlay error": To have a heading, a non-empty title needs to be set');if(void 0===t.modal&&(t.modal=!0),void 0===t.layer&&(t.layer=!0),t.compact&&t.heading&&t.heading.shaded)throw new Error('"o-overlay error": Compact overlays can\'t have a shaded header');return t}(o)}catch(t){throw this.broadcast("log","oErrors",{error:t}),t}if(!this.opts){var n=new Error('"o-overlay error": Required options have not been set');throw this.broadcast("log","oErrors",{error:n}),n}this.opts.trigger?(this.opts.trigger.addEventListener("click",p.bind(this.opts.trigger,e),!1),this.context=r.default.getLayerContext(this.opts.trigger)):document.querySelector(this.opts.parentnode)?this.context=document.querySelector(this.opts.parentnode):this.context=document.body,this.delegates={doc:new i.default,wrap:new i.default,context:new i.default},c[e]=this}var e,o,l;return e=t,l=[{key:"init",value:function(e){e||(e=document.body),e instanceof HTMLElement||(e=document.querySelector(e));for(var o=e.querySelectorAll(".o-overlay-trigger"),i=[],s=0;s<o.length;s++)c[o[s].getAttribute("data-o-overlay-id")]||i.push(new t(o[s].getAttribute("data-o-overlay-id"),d(o[s])));return i}},{key:"destroy",value:function(){Object.keys(c).forEach((function(t){c[t].destroy()}))}},{key:"getOverlays",value:function(){return c}}],(o=[{key:"open",value:function(){var t,e,o;if((this.opts.modal||this.opts.fullscreen)&&(this.originalOverflow=document.documentElement.style.overflow,document.documentElement.style.overflow="hidden"),window.history.pushState&&this.opts.fullscreen&&(window.history.pushState((t={},e="o-overlay-".concat(this.id),o="fullscreen",e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t),window.location.href),this.popstateHandler=function(){window.history.state&&window.history.state["o-overlay-".concat(this.id)]&&this.close()}.bind(this),window.addEventListener("popstate",this.popstateHandler)),this.opts.trigger&&this.opts.trigger.setAttribute("aria-pressed","true"),this.content)this.show();else{var i=this;this.loadContent((function(t){if(i.opts.html=t,!i.opts.html)throw new Error('"o-overlay error": Content for the overlay needs to be set via the "html" or the "src" option.');i.render()}))}}},{key:"loadContent",value:function(t){!this.opts.html&&this.opts.src?/^(https?\:\/)?\//.test(this.opts.src)?n.copyContentFromUrl(this.opts.src,(function(e){t(e)})):n.copyContentFromElement(document.querySelector(this.opts.src),(function(e){t(e)})):t(this.opts.html)}},{key:"render",value:function(){var t=document.createElement("div");if(t.className="o-overlay",t.classList.add("o-overlay--"+this.id.replace(" ","-")),this.opts.class)try{var e;(e=t.classList).add.apply(e,a(this.opts.class.split(" ")))}catch(t){console.warn("Could not add the classes: ".concat(this.opts.class))}if(this.opts.fullscreen&&t.classList.add("o-overlay--full-screen"),t.setAttribute("role","dialog"),this.opts.zindex&&(t.style.zIndex=this.opts.zindex),this.wrapper=t,this.opts.heading){var o=document.createElement("header"),i=this.opts.heading.title.replace(/\s+/g,"-").toLowerCase();if(o.classList.add("o-overlay__heading"),o.setAttribute("id",i),t.setAttribute("aria-labelledby",i),this.opts.heading.shaded&&o.classList.add("o-overlay__heading--shaded"),!this.opts.preventclosing){var s=document.createElement("button");s.className="o-overlay__close",s.setAttribute("aria-label","Close"),s.setAttribute("title","Close"),this.opts.nofocus||s.setAttribute("tabindex","0"),o.appendChild(s)}var r=document.createElement("span");r.setAttribute("role","heading"),r.className="o-overlay__title",this.opts.heading.visuallyhidetitle||(r.innerHTML=this.opts.heading.title),o.appendChild(r),t.appendChild(o)}if(this.opts.tooltip){var n=document.createElement("a");n.className="o-overlay__close",n.setAttribute("role","button"),n.setAttribute("href","#void"),n.setAttribute("aria-label","Close"),n.setAttribute("title","Close"),this.opts.nofocus||n.setAttribute("tabindex","0"),t.appendChild(n),t.classList.add("o-overlay--compact")}var l=document.createElement("section");l.className="o-overlay__content",t.appendChild(l),this.content=l,this.opts.compact&&t.classList.add("o-overlay--compact"),this.show()}},{key:"_trapFocus",value:function(){document.addEventListener("keydown",f.bind(this))}},{key:"show",value:function(){if(this.opts.modal){this.wrapper.classList.add("o-overlay--modal");var t=document.createElement("div");t.className="o-overlay-shadow",this.shadow=t,this.opts.zindex&&(t.style.zIndex=this.opts.zindex-1),document.body.appendChild(t)}this.delegates.doc.root(document.body),this.delegates.wrap.root(this.wrapper),this.delegates.context.root(this.context),this.closeHandler=this.close.bind(this),this.opts.nested||(this.resizeListenerHandler=this.resizeListener.bind(this),this.delegates.doc.on("oViewport.resize","body",this.resizeListenerHandler),this.closeOnEscapePressHandler=this.closeOnEscapePress.bind(this),this.delegates.doc.on("keyup",this.closeOnEscapePressHandler)),this.opts.layer&&(this.closeOnNewLayerHandler=this.closeOnNewLayer.bind(this),this.delegates.context.on("oLayers.new",this.closeOnNewLayerHandler),this.broadcast("new","oLayers")),(this.opts.heading||this.opts.tooltip||this.opts.customclose)&&(this.delegates.wrap.on("click",".o-overlay__close",this.closeHandler),this.delegates.wrap.on("touchend",".o-overlay__close",this.closeHandler)),this.closeOnExternalClickHandler=this.closeOnExternalClick.bind(this),this.delegates.doc.on("click","body",this.closeOnExternalClickHandler),this.delegates.doc.on("touchend","body",this.closeOnExternalClickHandler),this.context.appendChild(this.wrapper),this.opts.nofocus||(this.wrapper.setAttribute("tabindex","0"),this.wrapper.style.outline=0),window.requestAnimationFrame(function(){this.content.innerHTML||("string"==typeof this.opts.html?this.content.innerHTML=this.opts.html:this.content.appendChild(this.opts.html)),this.width=this.getWidth(),this.height=this.getHeight(),this.opts.nested||this.realign(),this.visible=!0,this.wrapper.focus(),this.broadcast("ready"),this.broadcast("event","oTracking",{category:"overlay",action:"show",overlay_id:this.id}),this._trapFocus()}.bind(this))}},{key:"close",value:function(){return this.delegates.doc.destroy(),this.delegates.wrap.destroy(),this.delegates.context.destroy(),(this.opts.modal||this.opts.fullscreen)&&(document.documentElement.style.overflow=this.originalOverflow),this.opts.fullscreen&&window.removeEventListener("popstate",this.popstateHandler),window.history.pushState&&window.history.state&&"fullscreen"===window.history.state["o-overlay-".concat(this.id)]&&window.history.back(),s.default.stopListeningTo("resize"),this.broadcast("destroy"),this.broadcast("event","oTracking",{category:"overlay",action:"close",overlay_id:this.id}),this.context.removeChild(this.wrapper),this.opts.modal&&this.shadow.parentNode.removeChild(this.shadow),this.opts.trigger&&(this.opts.trigger.focus(),this.opts.trigger.setAttribute("aria-pressed","false")),document.removeEventListener("keydown",f),this.visible=!1,this.opts.layer&&this.broadcast("close","oLayers"),!1}},{key:"closeOnExternalClick",value:function(t){this.wrapper.contains(t.target)||this.opts.modal||!this.opts.trigger||this.opts.trigger.contains(t.target)||this.close()}},{key:"closeOnEscapePress",value:function(t){this.opts.preventclosing||27!==t.keyCode||this.close()}},{key:"closeOnNewLayer",value:function(t){t.detail&&t.detail.el===this||this.close()}},{key:"resizeListener",value:function(t){this.wrapper.contains(t.target)||this.respondToWindow()}},{key:"broadcast",value:function(t,e,o){var i="oLayers"===(e=e||"oOverlay")?this.context:this.wrapper||document.body;o=o||{},"oTracking"!==e&&(o.el=this),i.dispatchEvent(new CustomEvent(e+"."+t,{detail:o,bubbles:"oLayers"!==e}))}},{key:"realign",value:function(t,e){if(!t&&!e)return this._align("width",s.default.getSize().width),void this._align("height",s.default.getSize().height);!t||e?this._align(t,e):this._align(t,s.default.getSize().dimension)}},{key:"_align",value:function(t,e){if("width"!==t&&"height"!==t)throw new Error('Can not realign the overlay for the dimension "'.concat(t,'". "height" or "width" expected.'));if(isNaN(e))throw new Error("Can not realign the overlay for the size ".concat(e,". A number is expected."));var o="width"===t?"left":"top";if(this.width=this.getWidth(),this.height=this.getHeight(),e<=this[t]){if(this.wrapper.classList.add("o-overlay--full-"+t),this.wrapper.style[o]="0",this.wrapper.style["margin"+n.capitalise(o)]=0,"height"===t){var i=this.wrapper.offsetHeight-this.wrapper.clientHeight;this.content.style.height=this.wrapper.offsetHeight-(this.opts.heading?this.wrapper.querySelector("header").offsetHeight:0)-i+"px"}}else"height"===t&&(this.content.style.height=null),this.wrapper.classList.remove("o-overlay--full-"+t),this.wrapper.style["margin"+n.capitalise(o)]=-this.wrapper["offset"+n.capitalise(t)]/2+"px",this.wrapper.style[o]="50%"}},{key:"respondToWindow",value:function(){this.realign()}},{key:"fills",value:function(t){return this.wrapper.classList.contains("o-overlay--full-"+t)}},{key:"destroy",value:function(){!0===this.visible&&this.close(),this.opts.trigger&&this.opts.trigger.removeEventListener("click",p),delete c[this.id]}},{key:"getHeight",value:function(){var t=this.wrapper.offsetHeight-this.wrapper.clientHeight;return this.content.scrollHeight+(this.opts.heading?this.wrapper.querySelector("header").offsetHeight:0)+t}},{key:"getWidth",value:function(){var t=this.wrapper.offsetWidth-this.wrapper.clientWidth;return this.content.scrollWidth+t}}])&&h(e.prototype,o),l&&h(e,l),t}();document.addEventListener("o.DOMContentLoaded",(function t(){y.init(),document.removeEventListener("o.DOMContentLoaded",t)}));e.default=y}}]);
//# sourceMappingURL=o-overlay.7f2be735bc80.bundle.js.map