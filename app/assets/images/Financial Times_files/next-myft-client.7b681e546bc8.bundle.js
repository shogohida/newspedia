(window.webpackJsonp=window.webpackJsonp||[]).push([["next-myft-client"],{"49c33d9d":function(t,e,n){"use strict";var o=n("d1224df5"),r=n("f55cce5d");t.exports=function(t){return/^\/(__)?myft\/api\//.test(t)||/^\/(__)?myft\/list/.test(t)||r(t)||o(t)}},"9be06faf":function(t,e,n){"use strict";t.exports=function(t){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/.test(t)}},d1224df5:function(t,e,n){"use strict";t.exports=function(t){return/\/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/.test(t)}},dcfa7677:function(t,e,n){"use strict";n.r(e);var o=n("8b8c7872"),r=n("08a04e80"),c=n("fafb79b7"),a=n.n(c);function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var u={total:0,items:[],count:0},f=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.apiRoot;if(i(this,t),!n)throw"User prefs must be constructed with an api root";this.apiRoot=n,this.loaded={}}var e,n,c;return e=t,(n=[{key:"init",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(this.initialised)return Promise.resolve();this.initialised=!0;var n=!/FTSession=/.test(document.cookie);return n?Promise.reject("No session cookie found"):(this.setPerfMark(),o.default.uuid().then((function(n){var r=n.uuid;if(!r)return Promise.reject("Session service returned undefined.");t.userId=r,t.headers={"Content-Type":"application/json","X-FT-Session-Token":o.default.cookie(),accept:"application/json"};var c=new Set([{relationship:"preferred",type:"preference"},{relationship:"enabled",type:"endpoint"},{relationship:"created",type:"list"}]);e.forEach((function(t){c.has(t)||c.add(t)})),c.forEach((function(e){return t.load(e)}))})).catch((function(t){if("No session cookie found"!==t.message)throw t})))}},{key:"setPerfMark",value:function(){var t=window.performance||window.msPerformance||window.webkitPerformance||window.mozPerformance;t&&t.mark&&Promise.all([new Promise((function(t){document.addEventListener("myft.user.followed.concept.load",t)})),new Promise((function(t){document.addEventListener("myft.user.saved.content.load",t)}))]).then((function(){return t.mark("myftLoaded")}))}},{key:"emit",value:function(t,e){document.body.dispatchEvent(new CustomEvent("myft.".concat(t),{detail:e,bubbles:!0}))}},{key:"fetchJson",value:function(t,e,n){var o={method:t,headers:this.headers,credentials:"include"};if(/undefined/.test(e)){var c="Request should not contain undefined.";return document.body.dispatchEvent(new CustomEvent("oErrors.log",{bubbles:!0,detail:{error:new Error(c)}})),Promise.reject(c)}return"GET"!==t&&(o.body=JSON.stringify(n||{})),fetch(this.apiRoot+e,o).then(r.json)}},{key:"load",value:function(t){var e=this,n="".concat(t.relationship,".").concat(t.type);this.fetchJson("GET","".concat(this.userId,"/").concat(t.relationship,"/").concat(t.type)).then((function(t){t||(t=u),e.loaded[n]=t,e.emit("user.".concat(n,".load"),t)})).catch((function(t){if("No user data exists"!==t.message)throw t;e.loaded[n]=u,e.emit("user.".concat(n,".load"),u)}))}},{key:"add",value:function(t,e,n,o,r,c,a){var i=this;return e=this.getFallbackActorIdIfNecessary(t,e),this.fetchJson("PUT","".concat(t,"/").concat(e,"/").concat(n,"/").concat(o,"/").concat(r),c).then((function(s){var u={actorId:e,results:s,subject:r,data:c,trackingInfo:a};return i.emit("".concat(t,".").concat(n,".").concat(o,".add"),u),u}))}},{key:"remove",value:function(t,e,n,o,r,c,a){var i=this;return e=this.getFallbackActorIdIfNecessary(t,e),this.fetchJson("DELETE","".concat(t,"/").concat(e,"/").concat(n,"/").concat(o,"/").concat(r),c).then((function(){var s={actorId:e,subject:r,data:c,trackingInfo:a};return i.emit("".concat(t,".").concat(n,".").concat(o,".remove"),s),s}))}},{key:"updateRelationship",value:function(t,e,n,o,r,c,a){var i=this;return e=this.getFallbackActorIdIfNecessary(t,e),this.fetchJson("PUT","".concat(t,"/").concat(e,"/").concat(n,"/").concat(o,"/").concat(r),c).then((function(s){var u={actorId:e,results:s,subject:r,data:c,trackingInfo:a};return i.emit("".concat(t,".").concat(n,".").concat(o,".update"),u),u}))}},{key:"get",value:function(t,e,n){var o=this;return this.getAll(t,e).then((function(t){return t.filter((function(t){return o.getUuid(t)===n}))}))}},{key:"getAll",value:function(t,e){var n=this;return new Promise((function(o){n.loaded["".concat(t,".").concat(e)]?o(n.getItems(t,e)):document.body.addEventListener("myft.user.".concat(t,".").concat(e,".load"),(function(){o(n.getItems(t,e))}))}))}},{key:"has",value:function(t,e,n){return this.get(t,e,n).then((function(t){return t.length>0}))}},{key:"getUuid",value:function(t){return t.uuid}},{key:"getItems",value:function(t,e){return this.loaded["".concat(t,".").concat(e)]&&this.loaded["".concat(t,".").concat(e)].items||[]}},{key:"personaliseUrl",value:function(t){return o.default.uuid().then((function(e){var n=e.uuid;return a()(t,n)}))}},{key:"getFallbackActorIdIfNecessary",value:function(t,e){if(e)return e;if("user"===t)return this.userId;throw new Error("no actorId specified")}},{key:"followPlusDigestEmail",value:function(t,e){var n=this;return this.fetchJson("PUT","".concat(this.userId,"/follow-plus-digest-email/").concat(t),e).then((function(o){var r={actorId:n.userId,results:o,subject:t,data:e};return n.emit("user.followed.concept.add",r),r}))}}])&&s(e.prototype,n),c&&s(e,c),t}();e.default=new f({apiRoot:"/__myft/api/onsite/"})},f55cce5d:function(t,e){t.exports=function(t){return/^\/(__)?myft\/(my-news|my-topics|preferences|product-tour)/.test(t)}},fafb79b7:function(t,e,n){"use strict";var o=n("49c33d9d"),r=n("9be06faf");t.exports=function(t,e){if(o(t))return t;if(!e)return t;if(!e.length||!r(e))throw new Error("Invalid user uuid: "+e);return t.replace(/myft(?:\/([a-zA-z\-]*))?(\/.[^$\/])?\/?/,(function(t,n,o){return"myft/"+(n?n+"/":"")+e+(o||"")}))}}}]);
//# sourceMappingURL=next-myft-client.7b681e546bc8.bundle.js.map