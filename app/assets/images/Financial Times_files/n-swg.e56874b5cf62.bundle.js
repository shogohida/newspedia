(window.webpackJsonp=window.webpackJsonp||[]).push([["n-swg"],{"07ba9a83":function(t,e){t.exports={getContentUuidFromUrl:function(){var t=this.getWindowLocation()||{},e=function(t,e){return e&&(e.match(t)||[])[1]};return e(/ft-content-uuid=([^&]+)/,t.search)||e(/content\/([^&?\/]+)/,t.href)},generateLoginUrl:function(){var t=this.getContentUuidFromUrl(),e=t&&"https://www.ft.com/content/".concat(t);return"https://www.ft.com/login?socialEnabled=true"+(e?"&location=".concat(encodeURIComponent(e)):"")},redirectTo:function(t){window.location.href=t},getWindowLocation:function(){return window.location},isProductSelector:function(){return/^\/products/.test(this.getWindowLocation().pathname)}}},"19157d05":function(t,e){function n(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}t.exports=function(){"use strict";function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.el=document.createElement("div"),this.el.classList.add("overlay__shadow"),this.wrapper=document.createElement("div"),this.wrapper.classList.add("overlay__wrapper"),this.content=document.createElement("div"),this.content.classList.add("overlay__content"),this.inner=document.createElement("div"),this.inner.classList.add("overlay__inner"),this.close=document.createElement("a"),this.close.classList.add("overlay__close"),this.content.appendChild(this.close),this.content.appendChild(this.inner),this.wrapper.appendChild(this.content),this.el.appendChild(this.wrapper),this.visible=!1,this.activity=!1,this.bindEvents()}var e,i,o;return e=t,(i=[{key:"generateCta",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.copy,n=t.callback,i=t.href,o=document.createElement("a");return o.classList.add("overlay__button"),o.innerHTML=e||i||"click me",n&&o.addEventListener("click",n),i&&(o.href=i),o}},{key:"bindEvents",value:function(){var t=this;this.close.addEventListener("click",(function(e){e.preventDefault(),t.activity||t.hide()})),document.body.addEventListener("keyup",(function(e){t.visible&&27===e.keyCode&&(t.activity||t.hide())}))}},{key:"show",value:function(t,e){if(this.activity=!1,this.inner.innerHTML="",t&&(this.inner.innerHTML=t),e){var n=this.generateCta(e);this.inner.appendChild(n)}document.body.appendChild(this.el),this.visible=!0}},{key:"hide",value:function(){document.body.removeChild(this.el),this.visible=!1}},{key:"showActivity",value:function(){this.activity=!0,this.content.classList.add("overlay__content--loading")}},{key:"hideActivity",value:function(){this.activity=!1,this.content.classList.remove("overlay__content--loading")}}])&&n(e.prototype,i),o&&n(e,o),t}()},"501502cb":function(t,e,n){var i=n("7c8e8e93"),o=n("07ba9a83"),r=n("c6cac58c"),a=n("9e5e510c"),s=n("19157d05"),c=n("ef79f542"),u=n("d23f602d");t.exports={_get:i,browser:o,events:r,importClient:a,Overlay:s,smartFetch:c,swgReady:u}},"7c8e8e93":function(t,e){t.exports=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if("object"==typeof t&&"string"==typeof e){for(var n=e.split("."),i=t,o=0;o<n.length;++o){if(void 0===i[n[o]])return;i=i[n[o]]}return i}}},"9e5e510c":function(t,e){t.exports=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document;return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.manual,i=void 0!==n&&n,o=e.src,r=e.id,a=void 0===r?"swg-client":r,s=e.sandbox,c=void 0!==s&&s,u=a&&!!t.querySelector("#"+a);if(!u){var l=t.createElement("SCRIPT");l.src=o||(c?"https://news.google.com/swg/js/v1/swg-tt.js":"https://news.google.com/swg/js/v1/swg.js"),l.async=!0,l.id=a,i&&l.setAttribute("subscriptions-control","manual"),t.body.appendChild(l)}}}},a78495ac:function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var r=n("501502cb").events;t.exports=function(){"use strict";function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=n.selector,r=void 0===o?"[data-n-swg-button]":o;i(this,t),this.buttons=Array.from(document.querySelectorAll(r)),this.swgClient=e,this.disableButtons()}var e,n,a;return e=t,(n=[{key:"init",value:function(){var t=this;this.buttons.forEach((function(e){e.addEventListener("click",t.handleClick.bind(t))})),r.listen("onReturn",this.onReturn.bind(this)),this.enableButtons()}},{key:"handleClick",value:function(t){t.preventDefault();try{var e=t.target.getAttribute("data-n-swg-button-skus").split(",");if(e.length>1)this.swgClient.showOffers({skus:e,isClosable:!0});else{if(1!==e.length)throw new Error("n-swg: No SKUs passed to button component.");this.swgClient.subscribe(e[0])}}catch(t){r.signal("onError",{error:t})}}},{key:"disableButtons",value:function(){this.buttons.forEach((function(t){t.disabled=!0}))}},{key:"enableButtons",value:function(){this.buttons.forEach((function(t){t.disabled=!1,t.removeAttribute("disabled")}))}},{key:"onReturn",value:function(){this.disableButtons()}}])&&o(e.prototype,n),a&&o(e,a),t}()},c6cac58c:function(t,e){t.exports={track:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:CustomEvent;document.body.dispatchEvent(new e("oTracking.event",{detail:t,bubbles:!0}))},signal:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:CustomEvent;document.body.dispatchEvent(new n("nSwg.".concat(t),{detail:e,bubbles:!0}))},signalError:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.signal("onError",{error:t,info:e})},listen:function(t,e){document.body.addEventListener("nSwg.".concat(t),(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e(t.detail)}))}}},d23f602d:function(t,e){t.exports=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self;return new Promise((function(e){(t.SUBSCRIPTIONS=t.SUBSCRIPTIONS||[]).push(e)}))}},dfce6c83:function(t,e,n){var i=n("e8e69574"),o=n("501502cb").importClient;t.exports={SwgController:i,swgLoader:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise((function(e,n){var o={manual:!!t.manualInitDomain,sandbox:!!t.sandbox};i.load(o).then((function(n){var o=new i(n,t);e(o)})).catch(n)}))},importClient:o()}},e8e69574:function(t,e,n){function i(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],i=!0,o=!1,r=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){o=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(o)throw r}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return o(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var s=n("501502cb"),c=s.swgReady,u=s.importClient,l=s.Overlay,d=s._get,h=s.events,f=s.smartFetch,v=s.browser,g=n("a78495ac");t.exports=function(){"use strict";function t(e){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g,a=arguments.length>3?arguments[3]:void 0;r(this,t),this.swgClient=e,this.manualInitDomain=i.manualInitDomain,this.MAX_RETRIES=2,this.M_SWG_URL=i.sandbox?"https://api-t.ft.com/commerce":"https://api.ft.com/commerce",this.M_SWG_SUB_SUCCESS_ENDPOINT=i.M_SWG_SUB_SUCCESS_ENDPOINT||"".concat(this.M_SWG_URL,"/v1/swg/subscriptions"),this.M_SWG_ENTITLED_SUCCESS_ENDPOINT=i.M_SWG_ENTITLED_SUCCESS_ENDPOINT||"".concat(this.M_SWG_URL,"/v1/swg/subscriptions/entitlementsCheck"),this.M_SWG_ACCOUNT_CHECK=i.M_SWG_ACCOUNT_CHECK||"".concat(this.M_SWG_URL,"/deferred-account"),this.POST_SUBSCRIBE_URL=i.POST_SUBSCRIBE_URL||"https://www.ft.com/profile?splash=swg_checkout",this.NEW_SWG_SUB_COOKIE="FTSwgNewSubscriber",this.handlers=Object.assign({onEntitlementsResponse:this.onEntitlementsResponse.bind(this),onFlowCanceled:this.onFlowCanceled.bind(this),onFlowStarted:this.onFlowStarted.bind(this),onPaymentResponse:this.onPaymentResponse.bind(this),onLoginRequest:this.onLoginRequest.bind(this),onResolvedEntitlements:this.defaultOnwardEntitledJourney.bind(this),onResolvedSubscribe:this.defaultOnwardSubscribedJourney.bind(this)},i.handlers);var s=function(t,e){return n.swgClient[t]&&e&&n.swgClient[t](e)};s("setOnEntitlementsResponse",this.handlers.onEntitlementsResponse),s("setOnPaymentResponse",this.handlers.onPaymentResponse),s("setOnLoginRequest",this.handlers.onLoginRequest),s("setOnFlowCanceled",this.handlers.onFlowCanceled),s("setOnFlowStarted",this.handlers.onFlowStarted),s("setOnNativeSubscribeRequest",this.handlers.onNativeSubscribeRequest),this.alreadyInitialised=!1,this.overlay=a||new l,this.baseTrackingData=t.generateTrackingData(i),i.subscribeFromButton&&(this.subscribeButtons=new o(e,{SwgController:t})),this.activeTrackingData,this.ENTITLED_USER="entitled_user",this.NEW_USER="new_user"}var e,n,o;return e=t,o=[{key:"load",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.manual,n=void 0!==e&&e,i=t.swgPromise,o=void 0===i?c():i,r=t.loadClient,a=void 0===r?u:r,s=t.sandbox,l=void 0!==s&&s;return new Promise((function(t,e){try{a(document)({manual:n,sandbox:l})}catch(t){e(t)}o.then(t)}))}},{key:"handleEntitlementsCallback",value:function(t){return t.ack(),{granted:t&&t.enablesThis&&t.enablesThis(),hasEntitlements:t&&t.enablesAny&&t.enablesAny(),json:t&&t.json&&t.json(),entitlements:t}}},{key:"generateTrackingData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{category:"SwG",formType:"swg.signup",production:!t.sandbox,paymentMethod:"SWG",system:{source:"n-swg"}}}},{key:"generateOfferDataFromSkus",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(1!==t.length)return{};var e=function(t,e){return t&&-1!==t.indexOf(e)},n=t[0].toLowerCase().split("_"),o=i(n,4),r=o[0],a=o[1],s=o[2],c=o[3],u=e(c,"trial"),l=s;switch(!0){case u:l="trial";break;case e(s,"1m"):l="monthly";break;case e(s,"1y"):l="annual"}return r&&"ft.com"===r?{offerId:a&&a.replace(/\./g,"-"),skuId:t[0],productName:c&&c.replace("."," "),term:l,productType:"Digital",isTrial:u,isPremium:e(c,"premium")}:{skuId:t[0]}}}],(n=[{key:"init",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.disableEntitlementsCheck,i=void 0!==n&&n;return new Promise((function(e){t.alreadyInitialised&&e(),h.listen("track",t.track.bind(t)),h.listen("onError",t.errorEventHandler.bind(t));var n=new Promise((function(t){return h.listen("onInitialEntitlementsEvent",t)}));t.manualInitDomain&&(t.swgClient.init(t.manualInitDomain),t.swgClient.getEntitlements()),t.alreadyInitialised=!0,i?(t.subscribeButtons&&t.subscribeButtons.init(),e(t)):n.then((function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n.granted&&n.json?(t.handlers.onResolvedEntitlements(n),e(t)):n.hasEntitlements?(v.isProductSelector()||t.overlay.show("<h3>You are trying to access Premium content</h3><p>The option to upgrade from Standard Digital to Premium Digital via Google is not available.</p><p>If you would like to discuss your subscription options, please contact Customer Services on 00800 0705 6477</p>"),e(t)):(t.subscribeButtons&&t.subscribeButtons.init(),e(t))}))}))}},{key:"checkEntitlements",value:function(){return this.swgClient.getEntitlements().then(t.handleEntitlementsCallback)}},{key:"isReadyToPay",value:function(){return this.swgClient.getEntitlements().then((function(t){return t.isReadyToPay}))}},{key:"onPaymentResponse",value:function(t){var e=this;return t.then((function(t){return e.subscribeButtons&&e.subscribeButtons.disableButtons(),h.signal("onSubscribeReturn",t),e.track({action:"success",context:{}}),e.setNewSwgSubscriberCookie(),e.resolveUser(e.NEW_USER,t).then((function(n){t.complete().then((function(){e.track({action:"google-confirmed"}),e.handlers.onResolvedSubscribe(n)}))})).catch((function(n){return t.complete().then((function(){e.track({action:"failure",context:{stage:"user-resolution"}}),e.onwardSubscriptionErrorJourney()})),Promise.reject(n)}))})).catch((function(t){h.signalError(t),e.track({action:"exit",context:{errCode:d(t,"activityResult.code"),errData:d(t,"activityResult.data")}})}))}},{key:"onFlowStarted",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.flow,n=t.data,i=n&&n.sku&&[n.sku],o={action:"flowStarted",context:{flowName:e,skus:i},journeyStart:!0};"subscribe"===e&&(o.action="landing"),this.track(o)}},{key:"onFlowCanceled",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.flow,n=t.data,i=n&&n.sku&&[n.sku],o={action:"flowCanceled",context:{flowName:e,skus:i}};"subscribe"===e&&(o.action="exit"),this.track(o)}},{key:"onEntitlementsResponse",value:function(e){return e.then(t.handleEntitlementsCallback).then((function(t){h.signal("onInitialEntitlementsEvent",t)})).catch(h.signalError)}},{key:"onLoginRequest",value:function(){v.redirectTo(v.generateLoginUrl())}},{key:"resolveUser",value:function(t,e){var n=this,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=t===this.NEW_USER,a=r?this.M_SWG_SUB_SUCCESS_ENDPOINT:this.M_SWG_ENTITLED_SUCCESS_ENDPOINT,s=r?JSON.stringify(e):JSON.stringify({createSession:i,swg:e});return new Promise((function(c,u){f.fetch(a,{method:"POST",credentials:"include",headers:{"content-type":"application/json"},body:s}).then((function(t){var e=t.json,o=d(e,"userInfo.newlyCreated"),a=-1!==document.cookie.indexOf(n.NEW_SWG_SUB_COOKIE);c({consentRequired:o||a,loginRequired:!r&&!1===i,raw:e})})).catch((function(r){o===n.MAX_RETRIES?u(r):(o++,n.track({action:"retry",context:{stage:"user-resolution",retries:o}}),n.resolveUser(t,e,i,o).then(c).catch(u))}))}))}},{key:"hasAccount",value:function(t){return f.fetch("".concat(this.M_SWG_ACCOUNT_CHECK),{method:"POST",credentials:"include",headers:{"content-type":"application/json"},body:t}).then((function(t){return!!d(t,"json.active")})).catch((function(){return!1}))}},{key:"defaultOnwardEntitledJourney",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=v.getContentUuidFromUrl(),i=this.POST_SUBSCRIBE_URL+(n?"&ft-content-uuid="+n:""),o=n?"https://www.ft.com/content/".concat(n):"https://www.ft.com",r="";this.track({action:"onward-entitled-journey"});var a=this.hasAccount(e.entitlements.entitlements[0].subscriptionToken);return this.swgClient.waitForSubscriptionLookup(a).then((function(n){return n?(t.track({action:"auto-login-start",context:{formType:r}}),t.swgClient.showLoginNotification().then((function(){return t.resolveUser(t.ENTITLED_USER,e.json)})).then((function(){t.track({action:"auto-login-success",context:{formType:r}}),v.redirectTo(o)})).catch((function(e){t.track({action:"auto-login-failed",context:{formType:r}}),h.signalError(e)}))):(t.track({action:"subscription-found",context:{formType:r}}),t.swgClient.completeDeferredAccountCreation({entitlements:e.entitlements,consent:!0}).then((function(e){return t.track({action:"create-account-continue",context:{formType:r}}),e.purchaseData&&e.purchaseData.raw&&e.purchaseData.raw.data&&(e.purchaseData.signature=e.purchaseData.raw.signature,e.purchaseData.raw=e.purchaseData.raw.data),t.resolveUser(t.NEW_USER,e).then((function(){return e.complete()})).then((function(){t.track({action:"google-confirmed",context:{formType:r}}),t.track({action:"create-account-success",context:{formType:r}}),v.redirectTo(i)})).catch((function(e){t.track({action:"create-account-failed",context:{formType:r}}),h.signalError(e)}))})).catch((function(e){t.track({action:"create-account-cancel",context:{formType:r}}),h.signalError(e)})))})).catch((function(t){h.signalError(t)}))}},{key:"defaultOnwardSubscribedJourney",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.consentRequired,n=void 0===e||e,i=v.getContentUuidFromUrl(),o=i?"https://www.ft.com/content/".concat(i):"https://www.ft.com",r=this.POST_SUBSCRIBE_URL+(i?"&ft-content-uuid="+i:"");v.redirectTo(n?r:o)}},{key:"onwardSubscriptionErrorJourney",value:function(){this.overlay.show("<h3>Sorry</h3><p>Something went wrong while creating your account on FT.com</p><p>Please call the FT customer services team on<br />00800 0705 6477</p>")}},{key:"track",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.action,i=e.context,o=void 0===i?{}:i,r=e.journeyStart,a=void 0!==r&&r,s=t.generateOfferDataFromSkus(o.skus);s&&a&&(this.activeTrackingData=s);var c=Object.assign({},this.baseTrackingData,this.activeTrackingData,o,{action:n});h.track(c)}},{key:"errorEventHandler",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:CustomEvent,n=Object.assign({},this.baseTrackingData,this.activeTrackingData,t.info),i=Object.assign({},t,{info:n});document.body.dispatchEvent(new e("oErrors.log",{detail:i,bubbles:!0}));var o=Object.assign({},n,{error:t.error},{action:"error"});h.track(o)}},{key:"setNewSwgSubscriberCookie",value:function(){document.cookie="".concat(this.NEW_SWG_SUB_COOKIE,"=true;Domain=ft.com")}}])&&a(e.prototype,n),o&&a(e,o),t}()},ef79f542:function(t,e){t.exports.fetch=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:self.fetch,i=function(t){return t.text().then((function(t){var e;try{e=JSON.parse(t)}catch(t){e={}}return e}))};return new Promise((function(o,r){n(t,Object.assign({},{method:"GET"},e)).then((function(t){200===t.status||201===t.status?i(t).then((function(e){o({json:e,headers:t.headers,status:t.status})})):t.text().then((function(e){r(new Error("Bad response STATUS=".concat(t.status,' TEXT="').concat(e,'"')))}))})).catch(r)}))}}}]);
//# sourceMappingURL=n-swg.e56874b5cf62.bundle.js.map