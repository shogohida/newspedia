(function(Math,doc){'use strict';var dropzoneElms=doc.querySelectorAll('.dropzone-placeholder'),inputLogoId=doc.querySelector('.js-inputLogoId'),inputBrandName=doc.querySelector('.js-inputBrandName');for(var i=0,l=dropzoneElms.length;i<l;i++){var loadDropzone=new Dropzone(dropzoneElms[i],{url:variables.upload_url,maxFiles:1,paramName:'logo',createImageThumbnails:false,dictCancelUpload:'Cancel',dictCancelUploadConfirmation:'Do you want to cancel uploading?',dictRemoveFile:'Remove',previewTemplate:"<div class=\"dz-preview dz-file-preview\"><div class=\"dz-details\"><div class=\"dz-filename\"><img class='dz-preview-check' src=\""+variables.static_url+"/static/img/check.svg\" /><span data-dz-name></span></div><a class=\"dz-remove\" data-dz-remove>Remove</a><div class=\"dz-size\" data-dz-size></div><div class=\"dz-progress\"><span class=\"dz-upload\" data-dz-uploadprogress></span></div></div><div class=\"dz-success-mark\"><span>✔</span></div><div class=\"dz-error-mark\"><span>✘</span></div><div class=\"dz-error-message\"><span data-dz-errormessage></span></div></div>",acceptedFiles:'image/svg+xml',accept:function(file,done){if(file.size>(1048576*2)){return done('File is too big');}
done();}});loadDropzone.on('success',function(file,response){var id=response.data.id,name=response.data.name;if(inputLogoId!==null){inputLogoId.value=id;}
if(inputBrandName!==null&&inputBrandName.value===''){inputBrandName.value=name;inputBrandName.focus();}});loadDropzone.on('removedfile',function(file){var files=loadDropzone.getAcceptedFiles();if(files.length===0){if(inputLogoId!==null){inputLogoId.value='';}}});}
var isIOS=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,download=doc.getElementById('download'),clickDownload=function(e){e.preventDefault();var redirect=this.getAttribute('data-redirect');var query='';if(isIOS){query='?ios=true';}
window.open(this.href+query,'_blank');window.location=redirect;};if(download!==null){download.addEventListener('click',clickDownload);}
var linkTag=function(tagsInput){var placeholder=tagsInput.getAttribute('data-placeholder'),name=tagsInput.getAttribute('data-name'),value=tagsInput.getAttribute('data-value'),tabIndex=tagsInput.getAttribute('data-tabindex');var tags=[];if(value!==''){tags=value.split(',');}
var loadTag=new Taggle(tagsInput,{tags:tags,tabIndex:Number(tabIndex),placeholder:placeholder,hiddenInputName:name,allowDuplicates:false,saveOnBlur:true,duplicateTagClass:'bounce'});var input=loadTag.getInput();var xhr;new autoComplete({selector:input,minChars:1,offsetLeft:-11,cache:false,onSelect:function(e,term,item){if(e.type!=='keydown'){loadTag.add(term);}},source:function(query,callback){if(xhr)xhr.abort();var tag_query=encodeURIComponent(query);xhr=new XMLHttpRequest();xhr.onload=function(){var response=this.response||this.responseText,jsonResponse;try{jsonResponse=JSON.parse(response);}catch(err){return;}
callback(jsonResponse);};xhr.open('GET',variables.url+'/tag-suggestions/'+tag_query+'?exclude='+(loadTag.getTags().values).join(','),true);xhr.send();}});};var tagsInputs=doc.querySelectorAll('.js-tagsInput');for(var i=0,l=tagsInputs.length;i<l;i++){linkTag(tagsInputs[i]);}
doc.getElementById('language_switch').addEventListener('click',function(e){e.preventDefault();})
function loadJSON(path,success,error)
{var xhr=new XMLHttpRequest();xhr.onreadystatechange=function()
{if(xhr.readyState===XMLHttpRequest.DONE){if(xhr.status===200){if(success)
success(JSON.parse(xhr.responseText));}else{if(error)
error(xhr);}}};xhr.open("GET",path,true);xhr.send();}
var search_suggestions_id='search_suggestions',search_field=doc.getElementById('search_field'),search_form=doc.getElementById('search_form'),search_suggestions=doc.getElementById(search_suggestions_id),LoadedSuggestions=[],checkForPossibleBlur=function(e){var node=e.target;if(node!==null&&node.id!=='search_field'&&node.id!==search_suggestions_id&&node.parentNode.id!==search_suggestions_id&&node.parentNode.parentNode.id!==search_suggestions_id){hideSuggestions();}},removeActive=function(){var selected=doc.querySelector('#'+search_suggestions_id+' li.active');if(selected!==null){selected.className='';}},searchSuggestion=function(){search_field.value=this.textContent;search_form.submit();},hideSuggestions=function(){search_suggestions.classList.add('hide');},showSuggestions=function(){if(search_suggestions.childNodes.length>0){search_suggestions.classList.remove('hide');}},parseKeyDown=function(e){switch(e.keyCode){case 38:e.preventDefault();break;case 40:e.preventDefault();break;default:}},parseKeyUp=function(e){switch(e.keyCode){case 38:var selectedup=doc.querySelector('#'+search_suggestions_id+' li.active');if(selectedup===null){var last=doc.querySelector('#'+search_suggestions_id+' li:last-child');last.className='active';this.value=last.textContent;}else{selectedup.className='';if(selectedup.previousSibling){selectedup.previousSibling.className='active';this.value=selectedup.previousSibling.textContent;}}
break;case 40:var selecteddown=doc.querySelector('#'+search_suggestions_id+' li.active');if(selecteddown===null){var first=doc.querySelector('#'+search_suggestions_id+' li:first-child');first.className='active';this.value=first.textContent;}else{selecteddown.className='';if(selecteddown.nextSibling){selecteddown.nextSibling.className='active';this.value=selecteddown.nextSibling.textContent;}}
break;default:getSeachSuggestions(this.value);}},searchSuggestionTimeOut=false,searchSuggestionDelay=100,getSeachSuggestions=function(value){if(searchSuggestionTimeOut){clearTimeout(searchSuggestionTimeOut);}
if(value!==''){searchSuggestionTimeOut=setTimeout(function(){var search_query=encodeURIComponent(value);var xhr=new XMLHttpRequest();xhr.onload=function(){var response=this.response||this.responseText,jsonResponse;try{jsonResponse=JSON.parse(response);}catch(err){return;}
if(jsonResponse.length===0){search_suggestions.classList.add('hide');return;}
for(var s=(LoadedSuggestions.length-1);s>0;s--){LoadedSuggestions[s].removeEventListener('mouseover',removeActive);LoadedSuggestions[s].removeEventListener('click',searchSuggestion);LoadedSuggestions.splice(s,1);}
while(search_suggestions.lastChild){search_suggestions.removeChild(search_suggestions.lastChild);}
var ul=doc.createElement('ul');for(var i=0,l=jsonResponse.length;i<l;i++){var li=doc.createElement('li');li.textContent=jsonResponse[i];li.addEventListener('mouseover',removeActive);li.addEventListener('click',searchSuggestion);ul.appendChild(li);LoadedSuggestions.push(li);}
search_suggestions.appendChild(ul);search_suggestions.classList.remove('hide');};xhr.open('GET',variables.url+'/search-suggestions/'+search_query,true);xhr.send();},searchSuggestionDelay);}else{search_suggestions.classList.add('hide');}};if(search_field!==null&&search_field.addEventListener){search_field.addEventListener('keydown',parseKeyDown);search_field.addEventListener('keyup',parseKeyUp);search_field.addEventListener('focus',showSuggestions);doc.addEventListener('mousedown',checkForPossibleBlur);}
var deleteForm=doc.getElementById('delete-form');if(deleteForm){var confirmed;deleteForm.addEventListener('submit',function(e){e.preventDefault();if(!confirmed){confirmed=confirm('Are you sure you want to delete this logo?');}
if(confirmed){deleteForm.submit();}});}})(Math,document);